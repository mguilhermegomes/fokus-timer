function crud() {
  const btnAdicionarTarefa = document.querySelector(".app__button--add-task");
  const btnCancelarTarefa = document.querySelector(".app__form-footer__button--cancel");
  const btnDeletarTarefa = document.querySelector(".app__form-footer__button--delete");
  const formTarefas = document.querySelector(".app__form-add-task");
  const textarea = document.querySelector(".app__form-textarea");
  const listaDeTarefas = document.querySelector(".app__section-task-list");
  let tarefas = [];

  btnAdicionarTarefa.addEventListener("click", () => {
    formTarefas.classList.toggle("hidden");
    formTarefas.ariaHidden =
      formTarefas.ariaHidden === "true" ? "false" : "true";
    scrollToEnd();
  });

  formTarefas.addEventListener("submit", (evento) => {
    evento.preventDefault();

    const tarefa = {
      descricao: textarea.value.trim(),
    };

    tarefas.push(tarefa);
    localStorage.setItem("tarefas", JSON.stringify(tarefas));

    exibirTarefas(tarefa);
    limparTextArea();
    esconderForm();
  });

  btnCancelarTarefa.addEventListener("click", () => {
    limparTextArea();
    esconderForm();
  });

  btnDeletarTarefa.addEventListener("click", () => {
    limparTextArea();
  });

  if (localStorage.getItem("tarefas")) exibirTarefasAnteriores();

  function scrollToEnd() {
    window.scrollTo(0, document.body.scrollHeight);
  }

  function criarElementoTarefa(descricao) {
    const tarefaItem = document.createElement("li");
    const tarefaSVG = document.createElement("svg");
    const tarefaDescricao = document.createElement("p");
    const tarefaBtn = document.createElement("button");
    const tarefaBtnImg = document.createElement("img");

    tarefaItem.classList.add("app__section-task-list-item");
    tarefaDescricao.classList.add("app__section-task-list-item-description");
    tarefaBtn.classList.add("app_button-edit");

    tarefaSVG.innerHTML = `
          <svg class="app__section-task-icon-status" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="12" fill="#FFF"></circle>
            <path d="M9 16.1719L19.5938 5.57812L21 6.98438L9 18.9844L3.42188 13.4062L4.82812 12L9 16.1719Z" fill="#01080E"></path>
        </svg>
    `;
    tarefaDescricao.textContent = descricao;
    tarefaBtnImg.setAttribute("src", "imagens/edit.png");
    tarefaBtn.appendChild(tarefaBtnImg);

    tarefaBtn.onclick = () => {
      editarTarefa(tarefaDescricao, tarefaBtn);
    }

    tarefaItem.appendChild(tarefaSVG);
    tarefaItem.appendChild(tarefaDescricao);
    tarefaItem.appendChild(tarefaBtn);

    return tarefaItem;
  }

  function exibirTarefas(tarefa) {
    listaDeTarefas.appendChild(criarElementoTarefa(tarefa.descricao));
  }

  function exibirTarefasAnteriores() {
    const tarefasAnteriores = localStorage.getItem("tarefas");
    const objTarefasAnteriores = JSON.parse(tarefasAnteriores);

    objTarefasAnteriores.forEach((tarefa) => {
      exibirTarefas(tarefa);
    });

  }

  function limparTextArea() {
    textarea.value = "";
  }

  function esconderForm() {
    formTarefas.classList.add("hidden");
    formTarefas.ariaHidden = "true";
  }

  function editarTarefa(elementoTexto, btnEditar) {
    const nomeAtual = elementoTexto.textContent.trim();

    elementoTexto.contentEditable = true;
    elementoTexto.focus();

    desabilitarBotao(btnEditar);

    function finalizarEdicao() {
      elementoTexto.contentEditable = false;
      habilitarBotao(btnEditar);
    }

    function validarNome() {
      if (elementoTexto.textContent.trim() === "") {
        elementoTexto.textContent = nomeAtual;
      }
    }

    elementoTexto.addEventListener("blur", () => {
      finalizarEdicao();
      validarNome();
    });
    
    elementoTexto.addEventListener("keydown", (evento) => {
      if (evento.key === "Enter") {
        evento.preventDefault();
        finalizarEdicao();
        validarNome();
      }
    })
  }
}

crud();